<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!--360浏览器优先以webkit内核解析-->


    <title>H+ 后台主题UI框架 - 主页示例</title>

    <link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/plugins/bootstrap-table/bootstrap-table.min.css">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=4.1.0" rel="stylesheet">
    

</head>

<body class="gray-bg">
    
    <!-- 加载动画 -->
    <div id="loading" style="margin-top:-20px;width:100%;height: 100%;background: rgba(0,0,0,0.5);position: fixed;z-index: 1000000;display: none;" >
        <div class="sk-spinner sk-spinner-three-bounce" style="position: relative;top:50%;height:11px; ">
            <div class="sk-bounce1"></div>
            <div class="sk-bounce2"></div>
            <div class="sk-bounce3"></div>
        </div>
    </div>
    <div class="col-sm-12 animated fadeInRight">
                        <!-- Example Events -->
                        <div class="example-wrap" id="exampleTableEvent">
                            <!-- <h4 class="example-title">事件</h4> -->
                            <div class="example">
                                <!-- <div class="alert alert-success" id="examplebtTableEventsResult" role="alert">
                                    事件结果
                                </div> -->
                                <div class="btn-group hidden-xs" id="exampleTableEventsToolbar" role="group">
                                    <button type="button" class="btn btn-outline btn-default" title="添加"  data-toggle="modal" data-target="#myModal5">
                                        <i class="glyphicon glyphicon-plus" aria-hidden="true"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline btn-default" id="editUser" title="编辑"   data-target="#myModal1">
                                        <i class="glyphicon glyphicon-edit" aria-hidden="true"></i>
                                    </button>
                                    <button type="button" class="btn btn-outline btn-default" id="delete" title="删除" >
                                        <i class="glyphicon glyphicon-trash" aria-hidden="true"></i>
                                    </button>
                                </div>
                                <table style="table-layout:fixed !important;" id="prejectsTableEvents" data-height="400" data-mobile-responsive="true">
                                    <thead>
                                        <tr>
                                            <th data-field="state" data-checkbox="false"></th>
                                            <th data-field="id" name="id" id="id">ID</th>
                                            <th data-field="projectTitle" name="projectTitle" id="projectTitle">房型（x人间）</th>
                                            <th data-field="projectTitle" name="projectTitle" id="projectTitle">收费标准（元/人/月）</th>
                                        </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
                        <!-- End Example Events -->
                    </div>

                    <div class="modal inmodal fade" id="myModal5" tabindex="-1" role="dialog"  aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                            <h4 class="modal-title">创建收费标准</h4>
                                            <small class="font-bold">创建新的收费标准
                                        </div>
                                        <div class="modal-body">
                                            <form class="m-t m-t-2" role="form" id="submitNewUser">
                                                <div class="form-group">
                                                        <input type="text"  id="maxNo" name="maxNo" class="form-control" placeholder="请输入房型" required="">
                                                        <input style="margin-top: 20px;" type="text"  id="charges" name="charges" class="form-control" placeholder="请输入价格" required="">
                                                </div>
                                            </form>


                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                                            <button type="button" class="btn btn-primary" id="registersubmit"  data-dismiss="modal">添加</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal inmodal fade" id="myModal1" tabindex="-1" role="dialog"  aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                            <h4 class="modal-title">修改收费标准</h4>
                                            <small class="font-bold">您可以在此页面编辑已经存在的收费标准
                                        </div>
                                        <div class="modal-body">
                                            <form class="m-t m-t-2" role="form" id="submitNewUser">
                                                <div class="form-group" >
                                                        <input type="text"  id="maxNo1" name="maxNo1" class="form-control" placeholder="请输入房型" required="">
                                                </div>
                                                    <div class="form-group" >
                                                        <input type="number" min="0"  id="charges1" name="charges1" class="form-control" placeholder="请输入价格" required="">
                                                    </div>

                                                </form>


                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-white" data-dismiss="modal">关闭</button>
                                            <button type="button" class="btn btn-primary" id="editsubmit"  data-dismiss="modal">提交</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            

                            
    

    <!-- 全局js -->
    <script src="js/jquery.min.js?v=2.1.4"></script>
    <script src="js/bootstrap.min.js?v=3.3.6"></script>
    <script src="js/plugins/layer/layer.min.js"></script>

    <!-- Bootstrap table -->
    <script src="js/plugins/bootstrap-table/bootstrap-table.min.js"></script>
    <!-- <script src="js/plugins/bootstrap-table/bootstrap-table-mobile.min.js"></script> -->
    <script src="js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
    <script type="text/javascript" src="./js/jquery-vilidate.js"></script>

    <!-- layerDate plugin javascript -->
    <script src="js/plugins/layer/laydate/laydate.js"></script>
    <script type="text/javascript" src="js/jquery.table2excel.js"></script>

    <!-- Peity -->
    <!-- <script src="js/demo/bootstrap-table-demo.js"></script> -->
    <!-- 自定义js -->
    <script src="js/content.js"></script>
    <script src="js/comm.js"></script>
    <!-- 欢迎信息 -->
    <script src="js/welcome.js"></script>
    <script type="text/javascript">
    $().ready(function() {

        

        
        var url = "http://10.11.18.222:5002/getRoomCharges";
        
         $("#prejectsTableEvents").bootstrapTable({
            method: 'get', //是否显示行间隔色
            striped: true, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
            cache: false, //是否显示分页（*）
            pagination: true, //是否启用排序
            sortName:'callBackRate',
            sortable: true, //排序方式
            sortOrder: "desc",//初始化加载第一页，默认第一页
            /*pageList: [10, 15, 25, 50, 100],*/
            //这个接口需要处理bootstrap table传递的固定参数,并返回特定格式的json数据
            url:url ,
            cache:false,//缓存
            pagination:true,//分页
            sidePagination:'client',//指定在前端客户端分页
            pageNumber:1,//页号
            pageSize:10,//页面数据条数
            pageList:[10,20,30,40,50],//分页列表
            toolbar:'#toolbar',//工具栏
            showColumns:true,//显示选择列
            showRefresh:true,//显示刷新按钮
            showToggle:true,//显示切换视图：列表和详情视图切换
            search:true,//显示搜索框
            columns:[
                {checkbox:true},
                {field: '',align: 'center',
                    formatter: function (value, row, index) {
                                return index + 1;
                    },title:'id',width:"10%"},
                {field:'maxNo',title:'房型（x人间）',width:"8%"},
                {field:'charges',title:'收费标准（元/人/月）',width:"8%"}
            ]
            ,
            queryParams: function (params) {
                    return {
                        inDateFrom: $('#start').val(),
            inDateTo: $('#end').val(),
            type: $("#viewType").attr("viewType")
                    };
            },
            strictSearch: true, //Enable the strict search.
            responseHandler: function(data){
                    return data.rows;
            }
        });

         $("#delete").click(function(){
            var _id = $(".selected").attr("id");
            //var id = sessionStorage.getItem('_id');
            //console.log(_id);
            if ( _id == "" || _id == undefined) {
                fail_prompt("请选择要删除的收费标准！");
            }else{
                $.ajax({
                url: "http://10.11.18.222:5002/deleteRoomCharges",
                type: "post",
                data: {
                    _id:_id
                },
                beforeSend:function(){
                    $("#loading").fadeIn(200);
                },
                success: function (data) {
                    $("#loading").fadeOut(200);
                    //alert(data.msg);
                    //重新加载记录
                    //重新加载数据
                    $("#prejectsTableEvents").bootstrapTable('refresh', {url: url});
                }
                });
                success_prompt("删除成功！");
            }
            
         })
         

         

        $("#registersubmit").click(function(){

            //console.log("hwogih");
            var maxNo = $("#maxNo").val();
            var charges = $("#charges").val();
            var data = {
                charges,maxNo
            }
            //console.log(data);
            $.ajax({
                url:"http://10.11.18.222:5002/addRoomCharges",
                method:"post",
                data:data,
                beforeSend:function(){
                    $("#loading").fadeIn(200);
                },
                success:function(result){
                $("#loading").fadeOut(200);
                //console.log(result);
                if (result.errorCode == "200") {
                    success_prompt("添加成功！");
                    $("#prejectsTableEvents").bootstrapTable('refresh', {url: url});
                }else{
                    fail_prompt(result.errorMessage)
                }
            }});   
        
            });


        $("#editUser").click(function(){
            var _id = $(".selected").attr("id");
            var maxNo = $(".selected").children().eq(2).text();
            var charges = $(".selected").children().eq(3).text();
            if (_id == undefined) {
                fail_prompt("请选择要编辑的房型收费标准！");
                $('#myModal1').modal({
                    show: false,
                    backdrop:'static'
                })
            }else{
                $("#maxNo1").val(maxNo);
                $("#charges1").val(charges);
                $('#myModal1').modal({
                    show: true,
                    backdrop:'static'
                })
            }
           
            $("#editsubmit").click(function(){
            var type = sessionStorage.getItem('type');
            //console.log("hwogih");
            var charges = $("#charges1").val();
            var maxNo = $("#maxNo1").val();
            var _id1 = $(".selected").attr("id");
            

            var data = {
                charges,maxNo,_id:_id1
                }
                //console.log(data);
                $.ajax({
                    url:"http://10.11.18.222:5002/updateRoomCharges",
                    method:"post",
                    data:data,
                    beforeSend:function(){
                    $("#loading").fadeIn(200);
                },
                    success:function(result){
                    $("#loading").fadeOut(200);    
                    //console.log(result);
                    if (result.errorCode == "200") {
                        success_prompt("修改成功！");
                        $("#prejectsTableEvents").bootstrapTable('refresh', {url: url});
                    }else if (result.errorCode == "404" || result.errorCode == "406") {
                        fail_prompt("修改失败，请重新编辑！")
                    }else if(result.errorCode == "405"){
                        fail_prompt("修改失败，请重新编辑！")
                    }
                }
                });
            
            })
             
        
            });
        


        

        


     })

    </script>
</body>

</html>
